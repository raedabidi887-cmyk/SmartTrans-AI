<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartTrans AI - Traduction Automatique</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .main-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .upload-area:hover {
            border-color: #764ba2;
            background-color: rgba(102, 126, 234, 0.05);
        }
        .upload-area.dragover {
            border-color: #764ba2;
            background-color: rgba(102, 126, 234, 0.1);
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        .language-select {
            border-radius: 15px;
            border: 2px solid #e9ecef;
            padding: 12px 15px;
            font-size: 16px;
        }
        .result-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            border: none;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        .loading {
            display: none;
        }
        .spinner-border-sm {
            width: 1rem;
            height: 1rem;
        }
        .file-info {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }
        .progress-bar {
            height: 8px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="main-container p-5">
                    <!-- Header -->
                    <div class="text-center mb-5">
                        <h1 class="display-4 fw-bold text-primary mb-3">
                            <i class="fas fa-language me-3"></i>SmartTrans AI
                        </h1>
                        <p class="lead text-muted">Traduction automatique de documents</p>
                    </div>

                    <!-- Upload Section -->
                    <div class="upload-area p-5 text-center mb-4" id="uploadArea">
                        <i class="fas fa-cloud-upload-alt fa-3x text-primary mb-3"></i>
                        <h4 class="mb-3">Glissez-déposez votre fichier ici</h4>
                        <p class="text-muted mb-3">ou cliquez pour sélectionner un fichier</p>
                        <p class="small text-muted">Formats supportés: PDF, DOCX, TXT</p>
                        <input type="file" id="fileInput" class="d-none" accept=".pdf,.docx,.txt">
                        <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                            <i class="fas fa-file-upload me-2"></i>Sélectionner un fichier
                        </button>
                    </div>

                    <!-- File Info -->
                    <div id="fileInfo" class="file-info" style="display: none;">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-file-alt fa-2x text-primary me-3"></i>
                            <div>
                                <h6 class="mb-1" id="fileName"></h6>
                                <small class="text-muted" id="fileSize"></small>
                            </div>
                        </div>
                    </div>

                    <!-- Analysis Section -->
                    <div class="text-center mb-4">
                        <button class="btn btn-primary btn-lg" id="analyzeBtn" onclick="analyzeFile()">
                            <i class="fas fa-search me-2"></i>Analyser le fichier
                        </button>
                        <div class="loading mt-3" id="analyzeLoading">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Analyse en cours...</span>
                            </div>
                            <p class="mt-2 text-muted">Détection de la langue en cours...</p>
                        </div>
                    </div>

                    <!-- Analysis Results -->
                    <div id="analysisResults" class="result-card p-4 mb-4" style="display: none;">
                        <h5 class="mb-3"><i class="fas fa-info-circle me-2"></i>Résultats de l'analyse</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Langue détectée:</strong> <span id="detectedLanguage" class="badge bg-primary"></span></p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Format:</strong> <span id="fileFormat" class="badge bg-secondary"></span></p>
                            </div>
                        </div>
                        <div class="mt-3">
                            <p><strong>Aperçu du contenu:</strong></p>
                            <div class="bg-light p-3 rounded">
                                <small id="contentPreview" class="text-muted"></small>
                            </div>
                        </div>
                    </div>

                    <!-- Translation Section -->
                    <div id="translationSection" style="display: none;">
                        <h5 class="mb-3"><i class="fas fa-globe me-2"></i>Traduction</h5>
                        
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label for="targetLanguage" class="form-label">Langue de destination</label>
                                <select class="form-select language-select" id="targetLanguage">
                                    <option value="">Sélectionnez une langue</option>
                                    <option value="Français">Français</option>
                                    <option value="Anglais">Anglais</option>
                                    <option value="Espagnol">Espagnol</option>
                                    <option value="Allemand">Allemand</option>
                                    <option value="Italien">Italien</option>
                                    <option value="Portugais">Portugais</option>
                                    <option value="Russe">Russe</option>
                                    <option value="Arabe">Arabe</option>
                                    <option value="Chinois">Chinois</option>
                                    <option value="Japonais">Japonais</option>
                                    <option value="Coréen">Coréen</option>
                                    <option value="Hindi">Hindi</option>
                                    <option value="Néerlandais">Néerlandais</option>
                                    <option value="Polonais">Polonais</option>
                                    <option value="Turc">Turc</option>
                                    <option value="Suédois">Suédois</option>
                                    <option value="Danois">Danois</option>
                                    <option value="Norvégien">Norvégien</option>
                                    <option value="Finnois">Finnois</option>
                                    <option value="Hongrois">Hongrois</option>
                                    <option value="Tchèque">Tchèque</option>
                                    <option value="Slovaque">Slovaque</option>
                                    <option value="Roumain">Roumain</option>
                                    <option value="Bulgare">Bulgare</option>
                                    <option value="Croate">Croate</option>
                                    <option value="Slovène">Slovène</option>
                                    <option value="Grec">Grec</option>
                                    <option value="Hébreu">Hébreu</option>
                                    <option value="Thaï">Thaï</option>
                                    <option value="Vietnamien">Vietnamien</option>
                                    <option value="Indonésien">Indonésien</option>
                                    <option value="Malais">Malais</option>
                                    <option value="Persan">Persan</option>
                                    <option value="Bengali">Bengali</option>
                                    <option value="Tamoul">Tamoul</option>
                                    <option value="Swahili">Swahili</option>
                                    <option value="Yoruba">Yoruba</option>
                                    <option value="Zoulou">Zoulou</option>
                                    <option value="Afrikaans">Afrikaans</option>
                                </select>
                            </div>
                            <div class="col-md-6 d-flex align-items-end">
                                <button class="btn btn-success btn-lg w-100" id="translateBtn" onclick="translateFile()">
                                    <i class="fas fa-language me-2"></i>Traduire
                                </button>
                            </div>
                        </div>

                        <div class="loading text-center" id="translateLoading">
                            <div class="spinner-border text-success" role="status">
                                <span class="visually-hidden">Traduction en cours...</span>
                            </div>
                            <p class="mt-2 text-muted">Traduction en cours...</p>
                            <div class="progress mt-3">
                                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Download Section -->
                    <div id="downloadSection" class="result-card p-4 text-center" style="display: none;">
                        <h5 class="mb-3"><i class="fas fa-download me-2"></i>Fichier traduit prêt</h5>
                        <p class="text-success mb-3" id="translateMessage"></p>
                        <button class="btn btn-primary btn-lg" id="downloadBtn" onclick="downloadFile()">
                            <i class="fas fa-download me-2"></i>Télécharger le fichier traduit
                        </button>
                    </div>

                    <!-- Error Messages -->
                    <div id="errorMessage" class="alert alert-danger mt-3" style="display: none;">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <span id="errorText"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentFile = null;
        let analysisData = null;

        // Drag and drop functionality
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileSelect(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileSelect(e.target.files[0]);
            }
        });

        function handleFileSelect(file) {
            const allowedTypes = ['.pdf', '.docx', '.txt'];
            const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
            
            if (!allowedTypes.includes(fileExtension)) {
                showError('Format de fichier non supporté. Veuillez sélectionner un fichier PDF, DOCX ou TXT.');
                return;
            }

            currentFile = file;
            showFileInfo(file);
            hideError();
            hideAnalysisResults();
            hideTranslationSection();
            hideDownloadSection();
        }

        function showFileInfo(file) {
            const fileInfo = document.getElementById('fileInfo');
            const fileName = document.getElementById('fileName');
            const fileSize = document.getElementById('fileSize');

            fileName.textContent = file.name;
            fileSize.textContent = formatFileSize(file.size);
            fileInfo.style.display = 'block';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        async function analyzeFile() {
            if (!currentFile) {
                showError('Veuillez d\'abord sélectionner un fichier.');
                return;
            }

            const formData = new FormData();
            formData.append('file', currentFile);

            showLoading('analyzeLoading');
            hideError();

            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (response.ok) {
                    analysisData = data;
                    showAnalysisResults(data);
                    showTranslationSection();
                } else {
                    showError(data.detail || 'Erreur lors de l\'analyse du fichier.');
                }
            } catch (error) {
                showError('Erreur de connexion. Veuillez réessayer.');
            } finally {
                hideLoading('analyzeLoading');
            }
        }

        function showAnalysisResults(data) {
            document.getElementById('detectedLanguage').textContent = data.detected_language;
            document.getElementById('fileFormat').textContent = data.file_extension.toUpperCase();
            document.getElementById('contentPreview').textContent = data.content_preview;
            document.getElementById('analysisResults').style.display = 'block';
        }

        async function translateFile() {
            const targetLanguage = document.getElementById('targetLanguage').value;
            
            if (!targetLanguage) {
                showError('Veuillez sélectionner une langue de destination.');
                return;
            }

            if (!analysisData) {
                showError('Veuillez d\'abord analyser le fichier.');
                return;
            }

            const formData = new FormData();
            formData.append('file_id', analysisData.file_id);
            formData.append('file_extension', analysisData.file_extension);
            formData.append('target_language', targetLanguage);

            showLoading('translateLoading');
            hideError();

            try {
                const response = await fetch('/translate', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (response.ok) {
                    showDownloadSection(data);
                } else {
                    showError(data.detail || 'Erreur lors de la traduction.');
                }
            } catch (error) {
                showError('Erreur de connexion. Veuillez réessayer.');
            } finally {
                hideLoading('translateLoading');
            }
        }

        function showDownloadSection(data) {
            document.getElementById('translateMessage').textContent = data.message;
            document.getElementById('downloadBtn').onclick = () => downloadFile(data.output_filename);
            document.getElementById('downloadSection').style.display = 'block';
        }

        function downloadFile(filename) {
            window.open(`/download/${filename}`, '_blank');
        }

        function showLoading(elementId) {
            document.getElementById(elementId).style.display = 'block';
        }

        function hideLoading(elementId) {
            document.getElementById(elementId).style.display = 'none';
        }

        function showError(message) {
            document.getElementById('errorText').textContent = message;
            document.getElementById('errorMessage').style.display = 'block';
        }

        function hideError() {
            document.getElementById('errorMessage').style.display = 'none';
        }

        function hideAnalysisResults() {
            document.getElementById('analysisResults').style.display = 'none';
        }

        function showTranslationSection() {
            document.getElementById('translationSection').style.display = 'block';
        }

        function hideTranslationSection() {
            document.getElementById('translationSection').style.display = 'none';
        }

        function hideDownloadSection() {
            document.getElementById('downloadSection').style.display = 'none';
        }
    </script>
</body>
</html> 